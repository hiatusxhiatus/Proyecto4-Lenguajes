<!-- app/views/invoices/index.html.erb -->
<div class="page-header-widget">
  <div class="page-header-content">
    <h1 class="page-title">Sistema de Facturación</h1>
    <div class="page-header-actions">
      <%= link_to "Nueva Factura", new_invoice_path, class: "btn btn-primary" %>
    </div>
  </div>
</div>

<% if @invoices.any? %>
  <div class="table-widget">
    <table class="table">
      <thead>
        <tr>
          <th>Número</th>
          <th>Cliente</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Subtotal</th>
          <th>Impuestos</th>
          <th>Total</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% @invoices.each do |invoice| %>
          <tr class="<%= 'invoice-finalized' if invoice.finalized? %>">
            <td><strong>#<%= invoice.invoice_number %></strong></td>
            <td><%= invoice.client_name %></td>
            <td><%= invoice.created_at ? Date.parse(invoice.created_at).strftime('%d/%m/%Y') : 'N/A' %></td>
            <td>
              <span class="badge badge-<%= invoice.finalized? ? 'success' : 'warning' %>">
                <%= invoice.finalized? ? 'Finalizada' : 'Borrador' %>
              </span>
            </td>
            <td>₡<%= sprintf('%.2f', invoice.subtotal) %></td>
            <td>₡<%= sprintf('%.2f', invoice.tax_total) %></td>
            <td><strong>₡<%= sprintf('%.2f', invoice.total) %></strong></td>
            <td>
              <%= link_to "Ver", invoice_path(invoice), class: "btn btn-primary btn-small" %>
              
              <% if invoice.can_be_edited? %>
                <%= link_to "Editar", edit_invoice_path(invoice), class: "btn btn-secondary btn-small" %>
              <% else %>
                <span class="btn btn-secondary btn-small disabled" title="No se puede editar una factura finalizada">
                  Editar
                </span>
              <% end %>
              
              <% if invoice.items.any? %>
                <%= link_to "PDF", download_pdf_invoice_path(invoice), class: "btn btn-success btn-small" %>
              <% end %>
              
              <% if invoice.can_be_edited? %>
                <%= button_to "Eliminar", invoice_path(invoice), 
                             method: :delete,
                             class: "btn btn-danger btn-small",
                             form: { onsubmit: "return confirm('¿Estás seguro?')" } %>
              <% else %>
                <span class="btn btn-danger btn-small disabled" title="No se puede eliminar una factura finalizada">
                  Eliminar
                </span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  
<% else %>
  <div class="empty-state-widget">
    <h3 class="empty-state-title">No hay facturas registradas</h3>
    <p>Comienza creando tu primera factura para gestionar las ventas</p>
    <%= link_to "Crear primera factura", new_invoice_path, class: "btn btn-primary" %>
  </div>
<% end %>

<style>
.badge {
  padding: 0.25em 0.6em;
  font-size: 0.75em;
  font-weight: 700;
  line-height: 1;
  text-align: center;
  white-space: nowrap;
  vertical-align: baseline;
  border-radius: 0.375rem;
}

.badge-success {
  color: #fff;
  background-color: #198754;
}

.badge-warning {
  color: #000;
  background-color: #ffc107;
}

.btn-small {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
  margin-right: 0.25rem;
}

.disabled {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none;
}

.invoice-finalized {
  background-color: #f8f9fa;
}

.invoice-finalized td {
  color: #6c757d;
}

.invoice-finalized td strong {
  color: #495057;
}
</style>